# Dokploy Traefik Configuration for BlytzLive Project
# This file works with docker-compose.blytzlive-example.yml
# Ensures unique routing to prevent conflicts with blytzwork project

http:
  routers:
    # Dokploy admin routing
    dokploy-router-app:
      rule: Host(`sudo.blytz.app`)
      service: dokploy-service-app
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
    
    dokploy-router-app-secure:
      rule: Host(`sudo.blytz.app`)
      service: dokploy-service-app
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
    
    # Production frontend routing - BLYTZLIVE
    blytzlive-router-app:
      rule: Host(`blytz.app`) || Host(`www.blytz.app`)
      service: blytzlive-service-app
      entryPoints:
        - web
        - websecure
      tls:
        certResolver: letsencrypt
    
    # Staging frontend routing - BLYTZLIVE
    blytzlive-staging-router-app:
      rule: Host(`staging.blytz.app`)
      service: blytzlive-service-app
      entryPoints:
        - web
        - websecure
      tls:
        certResolver: letsencrypt
    
    # Backend API routing - BLYTZLIVE
    blytzlive-backend-router:
      rule: Host(`api.blytz.app`)
      service: blytzlive-backend-service
      entryPoints:
        - web
        - websecure
      tls:
        certResolver: letsencrypt

  services:
    # Dokploy admin service
    dokploy-service-app:
      loadBalancer:
        servers:
          - url: http://dokploy:3000
        passHostHeader: true
    
    # Frontend service - BLYTZLIVE
    blytzlive-service-app:
      loadBalancer:
        servers:
          - url: http://frontend-final:3001
        passHostHeader: true
    
    # Backend service - BLYTZLIVE
    blytzlive-backend-service:
      loadBalancer:
        servers:
          - url: http://backend-final:3000
        passHostHeader: true

  middlewares:
    redirect-to-https:
      redirectScheme:
        scheme: https
        permanent: true