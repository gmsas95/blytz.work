// Minimal Working Schema for MVP
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("SUPABASE_DATABASE_URL")
  schemas  = ["blytz_hire"]
}

model User {
  id              String   @id @default(cuid())
  email           String   @unique
  role            String // "company" | "va" | "admin"
  emailVerified   Boolean  @default(false)
  profileComplete Boolean  @default(false)
  lastSeenAt      DateTime @updatedAt
  preferences     Json? // Notification preferences, timezone, etc.
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("users")
  @@schema("blytz_hire")
}

model JobPosting {
  id             String   @id @default(cuid())
  title          String
  description    String
  budget         Float? // Fixed price budget
  rateRange      String
  category       String?
  tags           String[]
  status         String   @default("open") // "open" | "in_progress" | "completed" | "cancelled"
  skillsRequired String[]
  views          Int      @default(0)
  proposals      Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("job_postings")
  @@schema("blytz_hire")
}

model Proposal {
  id           String   @id @default(cuid())
  jobPostingId String
  coverLetter  String
  bidAmount    Float
  bidType      String   @default("fixed") // "fixed" | "hourly"
  deliveryTime String // e.g., "3 days", "1 week"
  status       String   @default("pending") // "pending" | "viewed" | "accepted" | "rejected"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("proposals")
  @@schema("blytz_hire")
}

model Contract {
  id           String   @id @default(cuid())
  amount       Float
  contractType String // "fixed" | "hourly"
  status       String   @default("active") // "active" | "completed" | "cancelled"
  totalPaid    Float    @default(0)
  totalHours   Float? // For hourly contracts
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("contracts")
  @@schema("blytz_hire")
}

model Payment {
  id           String   @id @default(cuid())
  amount       Int // in cents
  status       String // "pending" | "processing" | "succeeded" | "failed" | "refunded"
  stripeFee    Int? // Stripe processing fee
  platformFee  Int? // Our platform fee
  method       String // "card" | "bank" | "crypto"
  type         String   @default("payment") // "payment" | "refund" | "payout"
  refundAmount Int? // Refund amount if any
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("payments")
  @@schema("blytz_hire")
}
