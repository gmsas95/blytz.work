http:
  routers:
    # Main Frontend HTTP (redirects to HTTPS)
    frontend-router-http:
      rule: Host(`blytz.app`) || Host(`www.blytz.app`)
      service: frontend-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    # Main Frontend HTTPS
    frontend-router-secure:
      rule: Host(`blytz.app`) || Host(`www.blytz.app`)
      service: frontend-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # Demo Interface - Viewer Platform with LiveKit Client
    demo-router-http:
      rule: Host(`demo.blytz.app`)
      service: demo-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    demo-router-secure:
      rule: Host(`demo.blytz.app`)
      service: demo-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # Seller Interface - Broadcaster Platform with LiveKit SDK
    seller-router-http:
      rule: Host(`seller.blytz.app`)
      service: seller-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    seller-router-secure:
      rule: Host(`seller.blytz.app`)
      service: seller-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # Dokploy Management
    dokploy-router-app:
      rule: Host(`dokploy.docker.localhost`) && PathPrefix(`/`) || Host(`sudo.blytz.app`)
      service: dokploy-service-app
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
    dokploy-router-app-secure:
      rule: Host(`sudo.blytz.app`)
      service: dokploy-service-app
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # API Gateway Router (for api.blytz.app)
    api-gateway-router-http:
      rule: Host(`api.blytz.app`)
      service: gateway-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
        - api-cors

    api-gateway-router-secure:
      rule: Host(`api.blytz.app`)
      service: gateway-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - api-cors

    # LiveKit Server Router (for livekit.blytz.app)
    livekit-router-http:
      rule: Host(`livekit.blytz.app`)
      service: livekit-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    livekit-router-secure:
      rule: Host(`livekit.blytz.app`)
      service: livekit-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - cors-headers

    # N8N Router
    n8n-router-http:
      rule: Host(`n8n.blytz.app`)
      service: n8n-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    n8n-router-secure:
      rule: Host(`n8n.blytz.app`)
      service: n8n-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # Hyred Router
    hyred-router-http:
      rule: Host(`hyred.blytz.app`)
      service: hyred-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
      priority: 10

    hyred-router-secure:
      rule: Host(`hyred.blytz.app`)
      service: hyred-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      priority: 10

    # Gateway Router (for blytz hire project)
    gateway-router-http:
      rule: Host(`gateway.blytz.app`)
      service: blytz-hire-gateway-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    gateway-router-secure:
      rule: Host(`gateway.blytz.app`)
      service: blytz-hire-gateway-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      middlewares:
        - api-cors

    # hyred postgres Router
    hyredb-router-http:
      rule: Host(`hyredb.blytz.app`)
      service: hire-postgres-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https

    hyredb-router-secure:
      rule: Host(`hyredb.blytz.app`)
      service: hire-postgres-service
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

  services:
    # Main Frontend Service
    frontend-service:
      loadBalancer:
        servers:
          - url: http://blytz-frontend-prod:3000
        passHostHeader: true

    # API Gateway Service
    gateway-service:
      loadBalancer:
        servers:
          - url: http://blytz-gateway-prod:8080
        passHostHeader: true

    # LiveKit Server Service
    livekit-service:
      loadBalancer:
        servers:
          - url: http://blytz-livekit-prod:7880
        passHostHeader: true

    # Demo Frontend Service - Viewer Platform
    demo-service:
      loadBalancer:
        servers:
          - url: http://blytz-demo-prod:3001
        passHostHeader: true

    # Seller Frontend Service - Broadcaster Platform
    seller-service:
      loadBalancer:
        servers:
          - url: http://blytz-seller-prod:3002
        passHostHeader: true

    dokploy-service-app:
      loadBalancer:
        servers:
          - url: http://dokploy:3000
        passHostHeader: true

    # N8N Service
    n8n-service:
      loadBalancer:
        servers:
          - url: http://blytz-hired-n8nwithpostgres-gidrup-n8n-1:5678
        passHostHeader: true

    # Hyred Service
    hyred-service:
      loadBalancer:
        servers:
          - url: http://frontend:3000
        passHostHeader: true

    # Gateway Service (for blytz hire project - using backend container)
    blytz-hire-gateway-service:
      loadBalancer:
        servers:
          - url: http://api-gateway:3000
        passHostHeader: true

    # Postgres Service for hyredb
    hire-postgres-service:
      loadBalancer:
        servers:
          - url: http://hire-postgres:5433
        passHostHeader: true

  middlewares:
    redirect-to-https:
      redirectScheme:
        scheme: https
        permanent: true

    # CORS middleware for LiveKit Cloud
    cors-headers:
      headers:
        customResponseHeaders:
          Access-Control-Allow-Origin: "*"
          Access-Control-Allow-Methods: "GET, POST, PUT, DELETE, OPTIONS"
          Access-Control-Allow-Headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,LiveKit-Token"
          Access-Control-Allow-Credentials: "true"
          Access-Control-Max-Age: "86400"

    # Security headers
    security-headers:
      headers:
        customResponseHeaders:
          X-Frame-Options: "SAMEORIGIN"
          X-Content-Type-Options: "nosniff"
          X-XSS-Protection: "1; mode=block"
          Strict-Transport-Security: "max-age=31536000; includeSubDomains"

    # API CORS middleware
    api-cors:
      headers:
        accessControlAllowOrigin:
          - "https://hyred.blytz.app"
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
          - "OPTIONS"
        accessControlAllowHeaders:
          - "Content-Type"
          - "Authorization"
        accessControlAllowCredentials:
          "true"
